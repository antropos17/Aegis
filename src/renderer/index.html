<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self' 'unsafe-inline'">
  <title>AEGIS</title>
  <link rel="stylesheet" href="../styles/variables.css">
  <link rel="stylesheet" href="../styles/base.css">
  <link rel="stylesheet" href="../styles/radar.css">
  <link rel="stylesheet" href="../styles/panels.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/feed-styles.css">
  <link rel="stylesheet" href="../styles/settings.css">
  <link rel="stylesheet" href="../styles/tabs.css">
  <link rel="stylesheet" href="../styles/responsive.css">
</head>
<body class="dark">
  <header>
    <div class="logo">
      <span class="logo-shield"></span>
      <h1>AEGIS</h1>
    </div>
    <div class="header-pills">
      <span id="scan-status" class="pulse">MONITORING</span>
      <span class="header-pill pill-shield" id="pill-shield"><span id="shield-score">100</span><span class="pill-label">% PROTECTED</span></span>
      <span class="header-pill pill-streak" id="pill-streak"><span id="streak-count">0</span><span class="pill-label">d STREAK</span></span>
      <span class="header-pill pill-agents" id="pill-agents"><span id="stat-agents">0</span><span class="pill-label"> AGENTS</span></span>
      <span class="header-pill pill-files" id="pill-files"><span id="stat-files">0</span><span class="pill-label"> FILES</span></span>
      <span id="last-scan"></span>
      <button id="theme-toggle" class="btn-theme" title="Toggle dark mode">&#9728;&#65039;</button>
      <button id="settings-btn" class="btn-gear" title="Settings">&#9881;</button>
    </div>
  </header>

  <button class="hamburger" id="hamburger-btn">&#9776;</button>
  <nav class="tab-bar">
    <button class="tab-pill active" data-tab="shield">&#128737;&#65039; SHIELD</button>
    <button class="tab-pill" data-tab="activity">&#128203; ACTIVITY</button>
    <button class="tab-pill" data-tab="rules">&#9881;&#65039; RULES</button>
    <button class="tab-pill" data-tab="reports">&#128202; REPORTS</button>
  </nav>

  <main>
    <!-- SHIELD TAB -->
    <div id="tab-shield" class="tab-view active">
        <section id="radar-section">
          <div class="radar-monitor">
            <canvas id="radar-canvas" width="400" height="400"></canvas>
          </div>
          <div class="radar-meta">
            <span class="radar-threat-pill threat-text-green" id="radar-threat-val">CLEAR</span>
            <span class="radar-uptime-pill">
              <span id="stat-uptime" class="radar-uptime-value">00:00:00</span>
              <span class="radar-uptime-label">UPTIME</span>
            </span>
            <span class="radar-alert-pill" id="stat-sensitive-wrap">
              <span id="stat-sensitive">0</span> ALERTS
            </span>
          </div>
        </section>

        <section id="timeline-section" class="timeline-section">
          <div id="timeline-strip" class="timeline-strip">
            <div id="timeline-dots" class="timeline-dots"></div>
            <div id="timeline-tooltip" class="timeline-tooltip"></div>
          </div>
        </section>

        <section id="activity-panel">
          <div class="activity-header">
            <h2>AI Agent Activity</h2>
            <div class="activity-controls">
              <span id="sensitive-count" class="sensitive-badge">0 SENSITIVE</span>
              <button id="clear-feed" class="btn-action btn-clear" title="Clear feed">CLEAR</button>
            </div>
          </div>
          <div id="activity-feed">
            <div class="empty-state">Waiting for AI agent file access events...</div>
          </div>
          <button id="show-more-feed" class="btn-show-more" style="display:none">Show more activity...</button>
        </section>

        <section id="agents-panel">
          <h2>Detected AI Agents</h2>
          <div id="agents-list">
            <div class="empty-state">&#x1F6E1; No AI agents detected. Shield is clear.</div>
          </div>
        </section>

      <section id="network-panel">
        <div class="network-header">
          <h2>Network Activity</h2>
          <span id="network-count" class="network-count-badge">0 connections</span>
        </div>
        <div id="network-list" class="network-list">
          <div class="empty-state">Scanning network connections...</div>
        </div>
      </section>

      <section id="other-agents-panel" class="other-panel collapsed">
        <div class="other-panel-header">
          <h2>Other Agent Processes</h2>
          <span id="other-agent-count" class="other-count-badge">0</span>
          <button id="other-toggle" class="btn-action btn-toggle">SHOW</button>
        </div>
        <div id="other-panel-content" class="other-panel-content">
          <div id="other-agents-list">
            <div class="empty-state">No other agent processes detected</div>
          </div>
          <div class="other-feed-header">
            <span class="other-feed-label">Activity</span>
            <span id="other-sensitive-count" class="sensitive-badge other-sensitive-badge">0 SENSITIVE</span>
          </div>
          <div id="other-activity-feed" class="other-feed">
            <div class="empty-state">No activity from other agent processes</div>
          </div>
        </div>
      </section>
    </div><!-- /tab-shield -->

    <!-- ACTIVITY TAB -->
    <div id="tab-activity" class="tab-view">
      <div class="activity-filter-bar">
        <select id="filter-agent"><option value="">All Agents</option></select>
        <select id="filter-severity">
          <option value="">All Severity</option>
          <option value="sensitive">Sensitive</option>
          <option value="config">Config</option>
          <option value="normal">Normal</option>
        </select>
        <select id="filter-filetype">
          <option value="">All Types</option>
          <option value="js">JavaScript</option>
          <option value="json">JSON/Config</option>
          <option value="env">Env/Keys</option>
          <option value="py">Python</option>
          <option value="other">Other</option>
        </select>
        <button id="clear-filters" class="btn-action btn-clear">CLEAR FILTERS</button>
      </div>
      <div id="full-activity-feed" class="full-activity-feed">
        <div class="empty-state">No activity events recorded yet</div>
      </div>
    </div>

    <!-- RULES TAB -->
    <div id="tab-rules" class="tab-view">
      <div class="rules-container">
        <div class="rules-header">
          <h2>Agent Permissions</h2>
          <span class="perm-legend">
            <span class="perm-legend-dot dot-allow"></span>Allow
            <span class="perm-legend-dot dot-monitor"></span>Monitor
            <span class="perm-legend-dot dot-block"></span>Block
          </span>
        </div>
        <div class="rules-presets">
          <span class="rules-presets-label">PRESETS:</span>
          <button class="btn-preset" data-preset="paranoid">PARANOID</button>
          <button class="btn-preset" data-preset="strict">STRICT</button>
          <button class="btn-preset active" data-preset="balanced">BALANCED</button>
          <button class="btn-preset" data-preset="developer">DEVELOPER</button>
        </div>
        <div id="rules-perm-grid" class="perm-grid-container"></div>
        <div class="rules-actions">
          <button id="rules-save" class="btn-action" style="background:var(--accent);color:#fff;font-weight:700">SAVE CHANGES</button>
          <button id="rules-reset" class="btn-action btn-clear">RESET TO DEFAULTS</button>
        </div>

        <!-- Agent Database Manager -->
        <div class="agentdb-divider"></div>
        <div class="agentdb-section">
          <div class="agentdb-header">
            <h2>Agent Database</h2>
            <div class="agentdb-header-actions">
              <button id="agentdb-add" class="btn-action" style="background:var(--accent);color:#fff;font-weight:700">+ ADD AGENT</button>
              <button id="agentdb-import" class="btn-action">IMPORT</button>
              <button id="agentdb-export" class="btn-action">EXPORT</button>
            </div>
          </div>
          <div class="agentdb-filters">
            <input type="text" id="agentdb-search" class="settings-input agentdb-search-input" placeholder="Search agents...">
            <select id="agentdb-filter-category" class="agentdb-select">
              <option value="">All Categories</option>
            </select>
            <select id="agentdb-filter-risk" class="agentdb-select">
              <option value="">All Risk</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
            <select id="agentdb-filter-vendor" class="agentdb-select">
              <option value="">All Vendors</option>
            </select>
          </div>
          <div class="agentdb-table-wrap">
            <table class="agentdb-table" id="agentdb-table">
              <thead>
                <tr>
                  <th class="agentdb-th-icon"></th>
                  <th>NAME</th>
                  <th>VENDOR</th>
                  <th>CATEGORY</th>
                  <th>TRUST</th>
                  <th>RISK</th>
                  <th>STATUS</th>
                  <th>ACTIONS</th>
                </tr>
              </thead>
              <tbody id="agentdb-tbody"></tbody>
            </table>
          </div>
          <div class="agentdb-footer">
            <span id="agentdb-count" class="agentdb-count">0 agents</span>
          </div>
        </div>
      </div>
    </div>

    <!-- REPORTS TAB -->
    <div id="tab-reports" class="tab-view">
      <div class="reports-container">
        <div class="reports-stats-grid">
          <div class="report-stat-card">
            <div class="report-stat-value" id="report-files">0</div>
            <div class="report-stat-label">FILES ACCESSED</div>
          </div>
          <div class="report-stat-card">
            <div class="report-stat-value" id="report-sensitive" style="color:var(--red)">0</div>
            <div class="report-stat-label">SENSITIVE ALERTS</div>
          </div>
          <div class="report-stat-card">
            <div class="report-stat-value" id="report-agents">0</div>
            <div class="report-stat-label">AGENTS DETECTED</div>
          </div>
          <div class="report-stat-card">
            <div class="report-stat-value" id="report-network">0</div>
            <div class="report-stat-label">NETWORK CONNECTIONS</div>
          </div>
        </div>

        <div class="reports-section-title">Export Data</div>
        <div class="reports-export-grid">
          <button id="export-log" class="btn-action" title="Export log as JSON">EXPORT JSON</button>
          <button id="export-csv" class="btn-action" title="Export log as CSV">EXPORT CSV</button>
          <button id="generate-report" class="btn-action btn-report" title="Generate HTML report">GENERATE REPORT</button>
        </div>

        <div class="reports-section-title">Agent Breakdown</div>
        <div id="reports-table-wrap" class="reports-table-wrap"></div>

        <div class="reports-section-title">Audit Log</div>
        <div id="audit-log-wrap" class="audit-log-wrap">
          <div class="audit-stats" id="audit-stats">
            <span class="audit-stat">Recording since: <strong id="audit-since">—</strong></span>
            <span class="audit-stat">Today: <strong id="audit-today">0</strong> entries</span>
            <span class="audit-stat">Log files: <strong id="audit-total-files">0</strong></span>
          </div>
          <div class="audit-actions">
            <button id="audit-view-logs" class="btn-action">VIEW AUDIT LOGS</button>
            <button id="audit-export-all" class="btn-action btn-report">EXPORT FULL AUDIT</button>
          </div>
        </div>

        <div class="reports-section-title">AI Threat Analysis</div>
        <div id="threat-analysis-wrap" class="threat-analysis-wrap">
          <button id="run-threat-analysis" class="btn-action btn-report">RUN AI THREAT ANALYSIS</button>
          <div id="threat-analysis-results"></div>
        </div>
      </div>
    </div>
  </main>

  <footer id="status-bar">
    <span class="footer-version">AEGIS v0.1.0-alpha</span>
    <span class="status-items">
      <span class="status-item">
        <span class="status-label">CPU</span>
        <span id="footer-cpu" class="status-value">—</span>
      </span>
      <span class="status-item">
        <span class="status-label">MEM</span>
        <span id="footer-mem" class="status-value">— MB</span>
      </span>
      <span class="status-item">
        <span class="status-label">HEAP</span>
        <span id="footer-heap" class="status-value">— MB</span>
      </span>
      <span class="status-item">
        <span class="status-label">SCAN</span>
        <span id="footer-interval" class="status-value">—s</span>
      </span>
    </span>
  </footer>

  <!-- Settings overlay -->
  <div id="settings-overlay" class="settings-overlay hidden">
    <div class="settings-panel">
      <div class="settings-header">
        <h2>Settings</h2>
        <button id="settings-close" class="btn-settings-close">&times;</button>
      </div>

      <div class="settings-section-title">Monitoring</div>

      <div class="settings-group">
        <label class="settings-label">Scan Interval</label>
        <div class="settings-row">
          <input type="range" id="setting-interval" min="3" max="60" value="3" class="settings-slider">
          <span id="setting-interval-val" class="settings-slider-val">3s</span>
        </div>
      </div>

      <div class="settings-group">
        <label class="settings-label">
          <input type="checkbox" id="setting-notifications" checked>
          Enable desktop notifications
        </label>
      </div>

      <div class="settings-section-title">Alerts</div>

      <div class="settings-group">
        <label class="settings-label">Custom Sensitive Patterns</label>
        <div class="settings-patterns">
          <div id="patterns-list" class="patterns-list"></div>
          <div class="patterns-add-row">
            <input type="text" id="pattern-input" class="settings-input" placeholder="Regex pattern, e.g. backup\.zip$">
            <button id="pattern-add" class="btn-action btn-pattern-add">ADD</button>
          </div>
        </div>
      </div>

      <div class="settings-section-title">System</div>

      <div class="settings-group">
        <label class="settings-label">Anthropic API Key</label>
        <input type="password" id="setting-api-key" class="settings-input" placeholder="sk-ant-...">
      </div>

      <div class="settings-group">
        <label class="settings-label">
          <input type="checkbox" id="setting-start-minimized">
          Start minimized to tray
        </label>
      </div>

      <div class="settings-group">
        <label class="settings-label">
          <input type="checkbox" id="setting-auto-start">
          Auto-start with Windows
        </label>
      </div>

      <div class="settings-actions">
        <button id="settings-save" class="btn-action">SAVE</button>
      </div>
    </div>
  </div>

  <!-- Analysis modal -->
  <div id="analysis-overlay" class="settings-overlay hidden">
    <div class="analysis-panel">
      <div class="settings-header">
        <h2 id="analysis-title">AI Risk Analysis</h2>
        <button id="analysis-close" class="btn-settings-close">&times;</button>
      </div>
      <div id="analysis-content" class="analysis-content">...</div>
    </div>
  </div>

  <!-- Agent Database Add/Edit modal -->
  <div id="agentdb-modal" class="settings-overlay hidden">
    <div class="settings-panel" style="width:500px">
      <div class="settings-header">
        <h2 id="agentdb-modal-title">Add Custom Agent</h2>
        <button id="agentdb-modal-close" class="btn-settings-close">&times;</button>
      </div>
      <div class="agentdb-form">
        <div class="settings-group">
          <label class="settings-label">Display Name *</label>
          <input type="text" id="agentdb-f-name" class="settings-input" placeholder="e.g. My Custom Agent">
        </div>
        <div class="settings-group">
          <label class="settings-label">Process Names (comma-separated) *</label>
          <input type="text" id="agentdb-f-patterns" class="settings-input" placeholder="e.g. myagent.exe, myagent">
        </div>
        <div class="agentdb-form-row">
          <div class="settings-group" style="flex:1">
            <label class="settings-label">Vendor</label>
            <input type="text" id="agentdb-f-vendor" class="settings-input" placeholder="e.g. My Company">
          </div>
          <div class="settings-group" style="flex:1">
            <label class="settings-label">Category</label>
            <select id="agentdb-f-category" class="agentdb-select agentdb-form-select">
              <option value="coding-assistant">Coding Assistant</option>
              <option value="ai-ide">AI IDE</option>
              <option value="cli-tool">CLI Tool</option>
              <option value="autonomous-agent">Autonomous Agent</option>
              <option value="desktop-agent">Desktop Agent</option>
              <option value="browser-agent">Browser Agent</option>
              <option value="agent-framework">Agent Framework</option>
              <option value="security-devops">Security/DevOps</option>
              <option value="ide-extension">IDE Extension</option>
            </select>
          </div>
        </div>
        <div class="agentdb-form-row">
          <div class="settings-group" style="flex:1">
            <label class="settings-label">Default Trust (0-100)</label>
            <input type="number" id="agentdb-f-trust" class="settings-input" min="0" max="100" value="50">
          </div>
          <div class="settings-group" style="flex:1">
            <label class="settings-label">Risk Profile</label>
            <select id="agentdb-f-risk" class="agentdb-select agentdb-form-select">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
        <div class="settings-group">
          <label class="settings-label">Known Domains (comma-separated)</label>
          <input type="text" id="agentdb-f-domains" class="settings-input" placeholder="e.g. api.example.com, example.com">
        </div>
        <div class="settings-group">
          <label class="settings-label">Description</label>
          <input type="text" id="agentdb-f-desc" class="settings-input" placeholder="Short description">
        </div>
        <div class="settings-group">
          <label class="settings-label">Website</label>
          <input type="text" id="agentdb-f-website" class="settings-input" placeholder="https://example.com">
        </div>
        <input type="hidden" id="agentdb-f-id">
        <input type="hidden" id="agentdb-f-builtin" value="false">
        <div class="settings-actions">
          <button id="agentdb-modal-save" class="btn-action" style="background:var(--accent);color:#fff;font-weight:700">SAVE AGENT</button>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden"></div>

  <script src="state.js"></script>
  <script src="helpers.js"></script>
  <script src="theme.js"></script>
  <script src="risk-scoring.js"></script>
  <script src="radar-state.js"></script>
  <script src="radar-draw.js"></script>
  <script src="radar-engine.js"></script>
  <script src="permissions.js"></script>
  <script src="agent-database-ui.js"></script>
  <script src="agent-database-crud.js"></script>
  <script src="agent-panel.js"></script>
  <script src="agent-render.js"></script>
  <script src="activity-feed.js"></script>
  <script src="network-panel.js"></script>
  <script src="timeline.js"></script>
  <script src="reports.js"></script>
  <script src="threat-analysis.js"></script>
  <script src="settings.js"></script>
  <script src="analysis.js"></script>
  <script src="app.js"></script>
</body>
</html>
